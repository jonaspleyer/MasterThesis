\begin{section}{The Internal Energy calculated explicitly}
% \begin{subsection}{The canonical ensemble formalism}
% TODO Taylor this section to the previous one!
The canonical ensemble was introduced in its mathematical form in the previous section. On the equilibrium submanifold of the TPS $B$, we can write the free energy as a function of the partition function $\Z$. The internal energy is then obtained by a change of coordinates or simply the equation $\F=\U+TS$. Microscopically the partition function is given by the behaviour of the $N$ particles determined by the Hamiltonian $H$. Concepts and definitions of Hamilton Mechanics can be read in \cite{eschrigTopologyGeometryPhysics2011, grosseAllgemeineRelativitaetstheorie2019, choquet-bruhatGeneralRelativityEinstein2009, choquet-bruhatIntroductionGeneralRelativity2015, choquet-bruhatAnalysisManifoldsPhysics2000, spivakPhysicsMathematiciansMechanics2010}. In general we assume $H:TM^N\rightarrow\R$ to be a positive smooth function on the manifold of space-time $M$. This explicitly takes form in the well known equations
% In the canonical ensemble the internal energy $\U$ can be calculated from the partition function $\Z$ via the following equations:
\begin{align}
	\Z(T,V,N) 	&= \int\limits_{TM^N}\exp\left(-\frac{H(x_1,\dots,x_N,p_1,\dots,p_N)}{k_BT}\right)\frac{dx_1dp_1\dots dx_Ndp_N}{N!h^{3N}}\\
	\F(T,V,N) 	&= - k_BT\log\left(\Z(T,V,N)\right)\label{2-IntEner-FreeEnerDef}\\
	\U(T,V,N) 	&= \F + T \Ent\\
				&= \F - T\frac{\partial\F}{\partial T}\\
				&= k_BT^2\frac{1}{\Z}\frac{\partial\Z}{\partial T}\label{2-IntEner-Def}.
\end{align}
where $x_i\in M$ and $p_i\in T_{x_i}M$. The last equation shows that to fully calculate $U$ it is necessary to obtain a readable output from $\Z$.
% \end{subsection}
\begin{subsection}{The Ultra-Relativistic Case}
First we inspect the ultra-relativistic Hamiltonian given by 
\begin{equation}
	H(\vec{x},\vec{p})=||\vec{p}||c.
\end{equation}
The corresponding partition function for a $N$ particle system then reads ($\beta=(k_BT)^{-1}$)
\begin{align}
	\Z 	&= \frac{V^N}{N!h^{3N}}\left[\int\limits_{\R^3}\exp\left(- \beta H(\vec{p})\right)d^3p\right]^N\\
		&= \frac{V^N}{N!h^{3N}}\left[\int\limits_0^\infty4\pi p^2\exp(-\beta pc) dp\right]^N\\
		&= \frac{V^N}{N!h^{3N}}\frac{(4\pi)^N(k_BT)^{3N}}{c^{3N}}\left[\int\limits_0^\infty x^2\exp(-x) dx\right]^N\\
	\Z	&= \frac{1}{N!}\left(8\pi V\left(\frac{k_BT}{hc}\right)^3\right)^N
	\label{2-IntEner-UltraRelZ}
\end{align}
where from the first to second line we used usual spherical coordinates and afterwards used the integral transformation $x=\beta cp$. The remaining integral $\U$ can be solved to be exactly $=2$ and the internal energy can now be written down and further approximated to subjective needs.
\end{subsection}
%
%
%
\begin{subsection}{The Special-Relativistic Case}
We will now turn our attention to the fully special-relativistic Hamiltonian given by
\begin{equation}
	H=mc^2\sqrt{1+\frac{\vec{p}^2}{m^2c^2}}.
\end{equation}
In doing so, we keep in mind that the ultra relativistic limit can be obtained from this Hamiltonian by letting $m\rightarrow0$. In this limiting case we should be able to recover the results from equation \eqref{2-IntEner-UltraRelZ}.
\begin{align}
	\Z 	&= \frac{V^N}{N!h^{3N}}\left[\int\limits_{\R^3}\exp\left(- \frac{mc^2\sqrt{1+\frac{\vec{p}^2}{m^2c^2}}}{k_BT}\right)d^3p\right]^N\label{2-IntEner-EQ1}\\
		&= \frac{V^N}{N!h^{3N}}\left[\int\limits_0^\infty 4\pi p^2\exp\left(-\beta mc^2\sqrt{1+\frac{p^2}{m^2c^2}} \right)dp\right]^N\\
		&= \frac{(4\pi V)^N}{N!}\left(\frac{mc}{h}\right)^{3N}\left[\int\limits_0^\infty q^2\exp\left(-\alpha\sqrt{1+q^2}\right)dq\right]^N\\
		&= \frac{(4\pi V)^N}{N!}\left(\frac{mc}{h}\right)^{3N}\left(\int\limits_0^\infty\sinh(x)^2\cosh(x)\exp(-\alpha\cosh(x))dx \right)^N\\
		&= \frac{(4\pi V)^N}{N!}\left(\frac{mc}{h}\right)^{3N}\left(\int\limits_0^\infty\frac{\sinh(2x)}{2}\sinh(x)\exp(-\alpha\cosh(x))dx \right)^N\\
		&= \frac{(4\pi V)^N}{N!}\left(\frac{mc}{h}\right)^{3N}\Biggl(\left.-\frac{\sinh(2x)}{2\alpha}\exp(-\alpha\cosh(x))\right|_0^\infty\\
		&\hspace{12em} + \frac{1}{\alpha}\int\limits_0^\infty\cosh(2x)\exp(-\alpha\cosh(x))dx  \Biggr)^N\\
		&= \frac{(4\pi V)^N}{N!}\left(\frac{mc}{h}\right)^{3N}\left(\frac{1}{\alpha}\int\limits_0^\infty\cosh(2x)\exp(-\alpha\cosh(x))dx  \right)^N\\
		&= \frac{1}{N!}\left(8\pi V\left(\frac{k_BT}{hc}\right)^{3}2\alpha^2K_2(\alpha)\right)^N
		\label{2-IntEner-PartFunc}
\end{align}
In the first step we used spherical coordinates followed by the substitution $qmc=p$ and $\alpha=\beta mc^2=mc^2/k_BT$. Afterwards we substituted $q=\sinh(x)$ and used the identity $\cosh(x)\sinh(x)=\sinh(2x)/2$. Partial integration then leads to the last integral which can be identified as the modified Bessel function of the 2nd kind $K_2(\alpha)$. The equation is then rewritten such that the ultra relativistic limit can be read off upon letting $\alpha\rightarrow0$.\\
We can now calculate the internal energy $\U$ from $\Z$ via equation \eqref{2-IntEner-Def}
\begin{equation}
    \U = 3Nk_BT - Nk_BT\left(\alpha\frac{\partial_\alpha K_2(\alpha)}{K_2(\alpha)}+2\right).
    \label{2-IntEner-InternelEnergyExplicit}
\end{equation}
Again, it can be seen that the ultra relativistic limit can be obtained by letting $\alpha\rightarrow0$ since the term written in brackets vanishes in this case.\\
From equation \eqref{2-IntEner-PartFunc} and \eqref{2-IntEner-FreeEnerDef}, we immediately derive the ideal gas equation via the definition of pressure in the canonical ensemble
\begin{equation}
    p=\frac{\partial\F}{\partial V} = \frac{Nk_ BT}{V}.
    \label{2-IntEner-IdealGasEq}
\end{equation}
\end{subsection}
%
%
%
\begin{subsection}{Deriving an equation of state}
This section aims to develop an equation between the thermodynamic energy density $\rho=\U/V$ and the pressure $p$ of the gas given by the ideal gas equation \eqref{2-IntEner-IdealGasEq}. This is done by assuming an additional constraint and thus further reducing the degrees of freedom of the thermodynamic system.\\
When assuming an adiabatic condition $\delta Q=0$ and using the First Law of Thermodynamics $dU = \delta Q + \delta W$, where $\delta W=-pdV$ and $dU=C_VdT$, we can relate pressure and temperature. Using equation \ref{2-IntEner-InternelEnergyExplicit} and \ref{2-IntEner-IdealGasEq}, we obtain
\begin{alignat}{3}
    -pdV &= C_VdT\\
    -\frac{Nk_BT}{V}dV &= Nk_B &\Biggl[1 + &\alpha^2\left(\left(\frac{\partial_\alpha K_2(\alpha)}{K_2(\alpha)}\right)^2 - \frac{\partial^2_\alpha K_2(\alpha)}{K_2(\alpha)}\right)\Biggr]dT\\
    - \frac{dV}{V} &= &\Biggl[1 - &\alpha^2\partial_\alpha\left(\frac{\partial_\alpha K_2(\alpha)}{K_2(\alpha)}\right)\Biggr]\frac{dT}{T}\\
    &= &\Bigl[1 - &\alpha^2\partial_\alpha^2\left(\log K_2(\alpha)\right)\Bigr]\frac{dT}{T}
\end{alignat}
This equation also shows explicitly the $T$ dependence of the specific heat $C_V$ for the non-ultra-relativistic case. Again, taking the ultra-relativistic-limit by taking $\alpha\rightarrow0$, one can calculate that the right hand term in the first equation converges to $-2Nk_B$. This agrees with the expected specific heat for an ultra-relativistic gas $C_{V,\text{ur}}=3Nk_B$. With the identity $d\alpha/\alpha = -dT/T$ (using $\alpha=mc^2/k_BT$), we can transform the equation and integrate it. After applying partial integration, the result is
\begin{align}
	\frac{dV}{V} &= \left(1-\alpha^2\partial_\alpha^2\log K_2(\alpha)\right)\frac{d\alpha}{\alpha}\\
    \log\left(\frac{V}{V_0}\right) &= \log\left(\frac{\alpha}{\alpha_0}\right) - \int\limits_{\alpha_0}^\alpha \alpha\frac{\partial^2}{\partial \alpha^2}\log(K_2(\alpha'))d\alpha'\\
    &=\log\left(\frac{\alpha}{\alpha_0}\right) + \log\left(\frac{K_2(\alpha)}{K_2(\alpha_0)}\right) - \Bigl[\alpha\frac{\partial_\alpha K_2}{K_2}\Bigr]_{\alpha_0}^\alpha
\end{align}
This equation enables us to write down a relation between volume and temperature (encapsulated in $\alpha=mc^2/k_BT$)
\begin{equation}
	V(\alpha) = \frac{\alpha K_2(\alpha)}{C}\exp\left(\alpha\frac{K_3(\alpha)+K_1(\alpha)}{2K_2(\alpha)}\right)
\end{equation}
where the constant $C$ is defined by the equation beforehand and only depends on the integration boundaries $\alpha_0$ and $V_0$. It is given by
\begin{equation}
	C = \frac{\alpha_0 K_2(\alpha_0)}{V_0}\exp\left(\alpha_0\frac{K_1(\alpha_0)+K_3(\alpha_0)}{2K_2(\alpha_0)}\right).
\end{equation}
Since the goal of this section is to obtain a readable output for an equation of state, it is necessary to construct a bijection relating $p$ and $T$. This is made clear when writing down the energy density
\begin{equation}
	\rho = \frac{\U}{V} = \frac{Nk_BT}{V} - \frac{Nk_BT}{V}\left(\alpha\frac{\partial_\alpha K_2(\alpha)}{K_2(\alpha)}\right)
	\label{2-IntEner-DensityAlpha}
\end{equation}
where $p=Nk_BT/V$ can be easily identified but the $T$ dependence through $\alpha$ is not solved yet.\\
The pressure $p$ can be rewritten to take the form
\begin{equation}
	p = \frac{Nk_BT}{V} = CNmc^2\frac{1}{K_2(\alpha)\alpha^2}\exp\left(-\alpha\frac{K_1(\alpha)+K_3(\alpha)}{2K_2(\alpha)}\right).
	\label{2-IntEner-PressureAlpha}
\end{equation}
At this point it is not reasonable to ask what happens in the ur-limit since $C$ depends non-trivially on $m$ and $m$ is not fully substituted in $\alpha$.\\
Interestingly, the pressure seems to be constant for very high temperatures. The limiting case is obtained when taking $T\rightarrow\infty$ (which corresponds to $\alpha\rightarrow0$)
\begin{equation}
	\lim\limits_{\alpha\to0}\left[\frac{1}{K_2(\alpha)\alpha^2}\exp\left(-\alpha\frac{K_1(\alpha)+K_3(\alpha)}{2K_2(\alpha)}\right)\right] = \frac{1}{2\e^2} \approx 0.006767.
\end{equation}
The same argument then holds true for the density given by equation \ref{2-IntEner-DensityAlpha} and since 
\begin{equation}
	\lim\limits_{\alpha\to0}\left[1+\alpha\frac{K_1(\alpha)+K_3(\alpha)}{2*K_2(\alpha)}\right] = 3
\end{equation}
we have
\begin{equation}
	\lim\limits_{\alpha\to0}\left(\frac{\rho(\alpha)}{Cmc^2}\right) = \frac{3}{2\e^2} \approx 0.203003.
\end{equation}
Figure \ref{2-IntEner-PressureDensityPlot} shows the behaviour of the pressure and density. We see that for a low temperature (corresponding to high $\alpha$), the pressure and density start to vanish. This is a expected behaviour and strengthens this result. Since in the coming sections will apply a polytropic equation of state as given in table \ref{4-NumSol-TOVParameters}, we try to compare it against this assumption. The (usually assumed constant) exponent of a polytropic equation of state $\rho=p^n$ can be calculated by
\begin{equation}
	n = \frac{\log(\rho)}{\log(p)}.
\end{equation}
This was also done in figure \ref{2-IntEner-PressureDensityPlot}. It can clearly be seen that the exponent is not constant and changes by $33\%$ along the path plotted. This observation makes it clear that a polytropic equation of state is (though often necessary) even in the simplest explicitly calculable example a simplification.
\begin{figure}[H]
	\centering
	\includesvg[width=\textwidth]{pictures/2-InternelEnergy-Explicit/RelEOS}
	\caption[]{}
	\label{2-IntEner-PressureDensityPlot}
\end{figure}

\begin{theorem}
	The mapping $p:\R_{>0}\rightarrow \R_{>0},\alpha\mapsto p(\alpha)$ written down in equation \eqref{2-IntEner-PressureAlpha} is a bijection for any $N,m,c,C\neq0$.
	\begin{equation}
		p = \frac{Nk_BT}{V} = CNmc^2\frac{1}{K_2(\alpha)\alpha^2}\exp\left(-\alpha\frac{K_1(\alpha)+K_3(\alpha)}{2K_2(\alpha)}\right)
	\end{equation}
\end{theorem}
\begin{proof}
	For this proof it suffices to show that the function $p(\alpha)$ has a strictly monotonous\footnote{We omit this word in this proof for readability.} behaviour. Without loss of generality, we assume $N,m,c,C>0$. Now it is obvious that the first two terms $Nmc^2/CK_2(\alpha)$ and $\alpha^{-2}$ are strictly decreasing. This is easy to see when using \cite{ModifiedBesselFunction}
	\begin{equation}
		\frac{\partial K_n}{\partial\alpha} = \frac{n}{\alpha}K_n-K_{n+1} = -\frac{K_{n-1}+K_{n+1}}{2}.
		\label{2-IntEner-BesselDerivative}
	\end{equation}
	We then calculate the derivative of the third term and divide by the exponential (since it is positive)
	\begin{align}
		&\hspace{1em} \frac{1}{\exp(\alpha\partial_\alpha\log(K_2))}\frac{\partial}{\partial\alpha}\exp(\alpha\partial_\alpha\log(K_2))\\
		&= \hspace{1em} \partial_\alpha\log(K_2) + \alpha\partial^2_\alpha\log(K_2)\\
		&= \hspace{1em} \frac{\partial_\alpha K_2}{K_2} + \alpha\frac{\partial^2_\alpha K_2}{K_2} + \alpha\left(\frac{\partial_\alpha K_2}{K_2}\right)^2\\
		&= \hspace{1em} \frac{K_1-\frac{2}{\alpha}K_2}{K_2} + \alpha\frac{\frac{1}{\alpha}K_1-K_2-\frac{2}{\alpha}\left(K_1-\frac{2}{\alpha}K_2\right)+\frac{2}{\alpha^2}K_2}{K_2^2} + \alpha\frac{K_1^2-\frac{1}{\alpha}K_1K_2-\frac{4}{\alpha^2}K_2^2}{K_2^2}\\
		&= -\alpha + \alpha\frac{K_1^2}{K_2^2} - 4\frac{K_1}{K_2}
	\end{align}
	thus it is sufficient to show that
	\begin{equation}
		\alpha\frac{K_1^2}{K_2^2}  < \alpha + 4\frac{K_1}{K_2}.
	\end{equation}
	We quickly prove the more general result $K_\nu<K_{\nu+1}$. One possible definition\cite{weissteinModifiedBesselFunction} for the Bessel function $K_\nu$ is given by
	\begin{equation}
		K_\nu := \frac{\sqrt{\pi}}{\left(\nu-\frac{1}{2}\right)!}\left(\frac{1}{2}z\right)^\nu\int\limits_1^\infty\e^{-tz}\left(t^2-1\right)^{\nu-\frac{1}{2}}dt
	\end{equation}
	We inspect the ratio
	\begin{equation}
		\frac{K_\nu}{K_{\nu+1}} = \frac{1}{\left(\nu+\frac{1}{2}\right)\left(\frac{1}{2}z\right)}\frac{\int\e^{-tz}\left(t^2-1\right)^{\nu-1/2}dt}{\int\e^{-tz}\left(t^2-1\right)^{\nu+1/2}dt}
	\end{equation}
	and rewrite the demoninator with partial integration
	\begin{equation}
		 \frac{1}{2}z\int\limits_1^\infty\e^{-tz}\left(t^2-1\right)^{\nu+1/2}dt = \left(\nu+\frac{1}{2}\right)\int\limits_1^\infty \e^{-tz}t\left(t^2-1\right)^{\nu-1/2}dt.
	\end{equation}
	Now it is obvious that $K_{\nu+1}>K_\nu$. Thus in total, the function given by equation \ref{2-IntEner-FinalEOS} can be inverted.
\end{proof}%
%
%
\noindent With this mapping $p:\R_{>0}\rightarrow \R_{>0},\alpha\mapsto p(\alpha)$ and its inverse $\alpha:\R_{>0}\rightarrow \R_{>0},p\mapsto \alpha(p)$, we can use \ref{2-IntEner-DensityAlpha} and finally write down the equation of state 
\begin{equation}
	\rho = \frac{\U}{V} = p\left(1+\alpha(p)\frac{K_1(\alpha(p))+K_3(\alpha(p))}{2K_2(\alpha(p))}\right).
	\label{2-IntEner-FinalEOS}
\end{equation}
If it is possible to obtain a readable output for $\alpha(p)$, this equation can further be used in combination with the TOV equation to obtain a radial dependence for pressure and density and ultimately the mass $M$ of the star.
\end{subsection}
%
%
\end{section}
